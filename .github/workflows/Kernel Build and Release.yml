name: Kernel Build and Release

on:
  workflow_dispatch:  # æ‰‹åŠ¨è§¦å‘

jobs:
  build:
    runs-on: ubuntu-latest
    container:
      image: debian:bookworm  # ä½¿ç”¨Debianç¨³å®šç‰ˆ

    steps:



    - name: ç”Ÿæˆå‘å¸ƒæ ‡ç­¾
      id: generate_tag
      run: |
          TAG_SUFFIX=$(date -u +"%Y %m %dT %H %M %SZ")
          echo "TAG_NAME=kernel-$TAG_SUFFIX" >> $GITHUB_ENV
          echo "â„¹ï¸ ç”Ÿæˆçš„å‘å¸ƒæ ‡ç­¾: kernel-$TAG_SUFFIX"

    - name: å‘å¸ƒç‰ˆæœ¬
      if: github.ref == 'refs/heads/main' && success()
      uses: softprops/action-gh-release@v2
      with:
        tag_name: ${{ env.TAG_NAME }}  # ä½¿ç”¨ä¸Šé¢ç”Ÿæˆçš„æ ‡ç­¾
        name: "å†…æ ¸æ„å»º #${{ github.run_number }} (${{ env.TAG_NAME }})"
        body: |
          ### ğŸš€ å†…æ ¸æ„å»ºè¯¦æƒ…
          - **æ„å»ºæ—¥æœŸ**: $(date)
          - **æäº¤SHA**: [${{ github.sha }}](https://github.com/${{ github.repository }}/commit/${{ github.sha }})
          - **æ„å»ºæ—¥å¿—**: [build_logs.tar.gz](build_logs.tar.gz)
          - **æ„å»ºID**: ${{ github.run_id }}
          - **å‘å¸ƒæ ‡ç­¾**: ${{ env.TAG_NAME }}
          
          ### ğŸ“² å®‰è£…è¯´æ˜
          1. ä¸‹è½½ `anykernel_flashable.zip`
          2. é‡å¯è¿›å…¥æ¢å¤æ¨¡å¼ (æ¨èä½¿ç”¨TWRP)
          3. åˆ·å…¥ZIPæ–‡ä»¶
          4. é‡å¯ç³»ç»Ÿ
          
          ### ğŸ“ æ„å»ºäº§ç‰©
          - `kernel_artifacts.tar.gz`: åŸå§‹å†…æ ¸äº§ç‰© (åŒ…å«å†…æ ¸é•œåƒå’Œé…ç½®æ–‡ä»¶)
          - `anykernel_flashable.zip`: å¯ç›´æ¥åˆ·å…¥çš„åˆ·æœºåŒ…
          
          ### â„¹ï¸ æ³¨æ„äº‹é¡¹
          - è¯·ç¡®ä¿è®¾å¤‡å…¼å®¹æ€§åå†åˆ·å…¥
          - åˆ·æœºå‰å»ºè®®å¤‡ä»½é‡è¦æ•°æ®
        files: |
          kernel_artifacts.tar.gz
          anykernel_flashable.zip
          build_logs.tar.gz
        draft: false
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        